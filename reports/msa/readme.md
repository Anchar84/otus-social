# Отчет по домашнему заданию Разделение монолита на сервисы.

### Архитектура

При выполнении домашних заданий курса сразу использовалась микросервисная архитектура, в результате на текущий момент система
состоит из следующих сервисов:
- модуль пользователей - хранит информацию о пользователях, отвечает за авторизацию
- модуль постов - хранит посты и информацию по подписках
- модуль диалогов - хранит диалоги между пользователями
- websocket - сервис для отправки постов пользователям-подписчикам через websocket

Также используются:
- postgres - содержит две реляционные базы для модулей пользователей и постов
- rabbitmq - брокер сообщений, используется для асинхронного запуска формирование кеша ленты постов (для каждого подписчика отдельное событие)
и инкрементального обновления ленты новостей через websocket
- redis - кеш ленты постов
- citus - используется для шардирования диалогов пользователей

Текущая архитектура практический не подразумевает прямого взаимодействия между модулями, так как все пользовательские запросы (кроме авторизации)
должны содержать jwt токен (в заголовок **X-Auth**) с данными пользователя и все параметры для обработки запроса.

Существующие сейчас взаимодействия между сервисами:
- сервис posts отправляет сообщение сам себе для обновление кеша ленты пользователей
- сервис posts отправляет сообщение в сервис websocket для online инсрементального обновление ленты постов пользователя  
через websocket (если у пользователя есть ws сессия)

HLD схему можно посмотреть в файле /docs/HLD схема сервисов.png (или /docs/схема сервисов.drawio)
Спецификацию сообщений, отправляемых через брокер можно посмотреть в файле /docs/broker.yaml

В качестве возможных изменений архитектуры можно рассмотреть добавление api gateway, которые будет принимать пользовательские http запросы, проводить их авторизацию и после 
этого проксировать запрос в сервисы. Такой подход с одной стороны позволит убрать проверку jwt токенов из самих модулей, с другой стороны в архитектуре появляется единая точка
отказа.

Запросы можно посмотреть в постман коллекции _postman_collection.json_, также для тестирование полчение сообщений необходимо установить соеднение _ws://localhost:8084/posts_
Для запуска проекта можно использовать _docker-compose.yml_, например командой _docker-compose -p otus-social up --scale worker=2_

